"use strict";var _createClass=function(){function c(d,e){for(var h,f=0;f<e.length;f++)h=e[f],h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(d,h.key,h)}return function(d,e,f){return e&&c(d.prototype,e),f&&c(d,f),d}}();function _classCallCheck(c,d){if(!(c instanceof d))throw new TypeError("Cannot call a class as a function")}var Particle=function(){function c(){var d=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,f=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,h=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,j=4<arguments.length&&void 0!==arguments[4]?arguments[4]:1,k=5<arguments.length&&void 0!==arguments[5]?arguments[5]:"#FFFFFF",l=6<arguments.length&&void 0!==arguments[6]?arguments[6]:1,m=7<arguments.length&&void 0!==arguments[7]?arguments[7]:1e5;_classCallCheck(this,c),this.x=d,this.y=e,this.dx=f,this.dy=h,this.mass=j,this.color=k,this.density=l,this.terminalVelocity=m}return _createClass(c,[{key:"applyForce",value:function applyForce(d,e,f){this.dx+=d*f/this.mass,this.dy+=e*f/this.mass,this.dx>this.terminalVelocity&&(this.dx=this.terminalVelocity),this.dy>this.terminalVelocity&&(this.dy=this.terminalVelocity),this.dx<-this.terminalVelocity&&(this.dx=-this.terminalVelocity),this.dy<-this.terminalVelocity&&(this.dy=-this.terminalVelocity)}},{key:"move",value:function move(){this.x+=this.dx,this.y+=this.dy}}]),c}(),Particles=function(){function c(d,e){if(_classCallCheck(this,c),d.domObject||(d.domObject=e),!d.domObject)throw new Error("Missing dom object");this.domObject=d.domObject,this.interactive=d.interactive||!1,this.repel=d.repel||!1,this.repel&&!this.interactive&&console.log("You specified to have particles replled by the mouse without interactivity"),this.clickToAdd=d.clickToAdd||!1,this.clickToAdd&&!this.interactive&&console.log("You specified to be able to click to add particles, but without interactivity enabled"),this.gravity=d.gravity||!1,this.falling=d.falling||!1,this.walled=d.walled||!1,this.teleportWalls=d.teleportWalls||!1,this.teleportWalls&&!this.walled&&console.log("You specified to have teleportWalls but without walls; therefore, particles will never teleport"),this.terminalVelocity=d.terminalVelocity?d.terminalVelocity:1e4,this.particleColor=d.particleColor?d.particleColor:void 0,this.particles=d.particles?d.particles:[],this.connected=d.connected||!1,this.latticeDistance=d.latticeDistance?d.latticeDistance:250,this.debug=d.debug||!1,this.frameTime=d.frameTime||!1,this.linesDrawn=0,this.clickPos=void 0,this.mousePos={x:0,y:0},this.clicked=!1,this.timeClicked=void 0,this.domObject.width=this.domObject.offsetWidth*window.devicePixelRatio,this.domObject.height=this.domObject.offsetHeight*window.devicePixelRatio,this.domObject.style.background=d.backgroundColor?d.backgroundColor:"rgb(255,255,255)",this.domObject.addEventListener("mousedown",this.handleMouseDown.bind(this)),this.domObject.addEventListener("mousemove",this.handleMouseMove.bind(this)),this.domObject.addEventListener("mouseup",this.handleMouseUp.bind(this)),d.random&&this.randomize(d.random)}return _createClass(c,[{key:"doPhysics",value:function doPhysics(){if(this.gravity)for(var d=0;d<this.particles.length;d++)for(var e=d+1;e<this.particles.length;e++){var f=this.particles[d],h=this.particles[e],j=distanceBetween(f,h);if(!(0.5>j)){var k=(h.x-f.x)/j,l=(h.y-f.y)/j,m=0.1*f.mass*h.mass/j;f.applyForce(k,l,m),h.applyForce(-1*k,-1*l,m)}}if(this.falling)for(var p=void 0,n=0;n<this.particles.length;n++)p=this.particles[n],p.applyForce(0,1,p.mass);if(this.interactive&&this.repel&&this.repelParticles(),this.particles.forEach(function(t){return t.move()}),this.walled)for(var q=void 0,s=void 0,n=0;n<this.particles.length;n++)q=this.particles[n],this.teleportWalls?(0>q.y&&(q.y=this.domObject.height),0>q.x&&(q.x=this.domObject.width),q.y>this.domObject.height&&(q.y=0),q.x>this.domObject.width&&(q.x=0)):(s=10*q.mass/q.density,0>q.y-s&&(q.y=s,q.dy=-q.dy),0>q.x-s&&(q.x=s,q.dx=-q.dx),q.x+s>this.domObject.width&&(q.x=this.domObject.width-s,q.dx=-q.dx),q.y+s>this.domObject.height&&(q.y=this.domObject.height-s,q.dy=-q.dy))}},{key:"repelParticles",value:function repelParticles(){if(this.interactive&&this.repel)for(var e=void 0,f=void 0,h=void 0,j=void 0,k=void 0,d=0;d<this.particles.length;d++)e=this.particles[d],f=distanceBetween(e,this.mousePos),250>f&&(j=(e.x-this.mousePos.x)/f,k=(e.y-this.mousePos.y)/f,h=100/f,e.applyForce(j,k,h))}},{key:"render",value:function render(){this.domObject.getContext("2d").clearRect(0,0,this.domObject.width,this.domObject.height),this.linesDrawn=0;var h=this.domObject.getContext("2d");if(h.font=11*window.devicePixelRatio+"px arial",this.connected){h.lineWidth=5;for(var j=void 0,k=void 0,l=void 0,m=void 0,d=0;d<this.particles.length;d++){k=this.particles[d];for(var e=d+1;e<this.particles.length;e++)l=this.particles[e],j=distanceBetween(k,l),j<this.latticeDistance&&(this.linesDrawn++,m=-j/this.latticeDistance+1,h.strokeStyle="rgba(255,255,255,"+m+")",h.beginPath(),h.moveTo(k.x,k.y),h.lineTo(l.x,l.y),h.stroke())}}for(var n,f=0;f<this.particles.length;f++)if(n=this.particles[f],h.beginPath(),h.fillStyle=n.color,h.arc(n.x,n.y,10*n.mass/n.density,0,2*Math.PI),h.fill(),this.debug){var o=n.x-55*window.devicePixelRatio,p=n.y-10*n.mass-5;h.fillText("("+Math.trunc(n.x)+","+Math.trunc(n.y)+"),<"+Math.trunc(100*n.dx)/100+","+Math.trunc(100*n.dy)/100+">",o,p)}this.interactive&&this.clicked&&this.clickToAdd&&(h.strokeStyle="white",h.lineWidth=5*window.devicePixelRatio,h.beginPath(),h.moveTo(this.clickPos.x,this.clickPos.y),h.lineTo(this.mousePos.x,this.mousePos.y),h.stroke(),h.beginPath(),h.fillStyle="white",h.arc(this.clickPos.x,this.clickPos.y,(new Date().getTime()-this.timeClicked)/50,0,2*Math.PI),h.fill()),this.debug&&this.interactive&&(h.beginPath(),h.fillStyle="black",h.arc(this.mousePos.x,this.mousePos.y,5,0,2*Math.PI),h.fill())}},{key:"run",value:function run(){if(this.running){var d,e,f;if(this.frameTime&&(d=new Date().getTime()),this.doPhysics(),this.frameTime&&(e=new Date().getTime()),this.render(),this.frameTime){f=new Date().getTime();var h=this.domObject.getContext("2d");h.font=11*window.devicePixelRatio+"px arial",h.fillStyle="white",h.fillText("Physics:"+(e-d)+"ms",0,20),h.fillText("Render:"+(f-e)+"ms",0,20+11*window.devicePixelRatio),h.fillText("Particles:"+this.particles.length,0,20+22*window.devicePixelRatio),h.fillText("Lines Drawn:"+this.linesDrawn,0,20+33*window.devicePixelRatio)}requestAnimationFrame(this.run.bind(this))}}},{key:"start",value:function start(){this.running||(this.running=!0,this.run())}},{key:"setParticles",value:function setParticles(d){this.particles=d}},{key:"addParticles",value:function addParticles(d){this.particles=this.particles.concat(d)}},{key:"togglePause",value:function togglePause(){this.running?this.running=!1:(this.running=!0,this.run())}},{key:"toggleInteractivity",value:function toggleInteractivity(){this.interactive=!this.interactive}},{key:"stop",value:function stop(){this.running=!1}},{key:"toggleDebug",value:function toggleDebug(){this.debug=!this.debug}},{key:"toggleFrameTime",value:function toggleFrameTime(){this.frameTime=!this.frameTime}},{key:"handleMouseDown",value:function handleMouseDown(d){this.interactive&&(this.clickPos=getMousePos(this.domObject,d),this.clicked=!0,this.timeClicked=new Date().getTime())}},{key:"handleMouseUp",value:function handleMouseUp(){if(this.interactive&&(this.clicked=!1,this.clickToAdd)){var d=(new Date().getTime()-this.timeClicked)/500,e=(this.mousePos.x-this.clickPos.x)/500,f=(this.mousePos.y-this.clickPos.y)/500,h=new Particle(this.clickPos.x,this.clickPos.y,e,f,d,this.particleColor,1,this.terminalVelocity);this.particles.push(h)}}},{key:"handleMouseMove",value:function handleMouseMove(d){this.interactive&&(this.mousePos=getMousePos(this.domObject,d))}},{key:"clear",value:function clear(){this.particles=[]}},{key:"randomize",value:function randomize(d){if(!d)return void this.randomize({});for(var f=d.number?d.number:10,h=d.clear||!1,j=d.minMass?d.minMass:1,k=d.maxMass?d.maxMass:5,l=d.minDx?d.minDx:-1,m=d.maxDx?d.maxDx:1,n=d.minDy?d.minDy:-1,o=d.maxDy?d.maxDy:1,p=d.color?d.color:this.particleColor,q=[],e=0;e<f;e++){var s=Math.random()*this.domObject.width,t=Math.random()*this.domObject.height,u=Math.random()*(m-l)+l,v=Math.random()*(o-n)+n,w=Math.random()*(k-j)+j,z=void 0;if(!p){var A=parseInt(255*Math.random()),B=parseInt(255*Math.random()),C=parseInt(255*Math.random());z="rgb("+A+","+B+","+C+")"}else z=p;q[e]=new Particle(s,t,u,v,w,z,1,this.terminalVelocity)}h&&this.clear(),this.addParticles(q)}}],[{key:"configs",value:function configs(){return{snow:{walled:!0,particleColor:"rgba(255,255,255,0.8)",backgroundColor:"rgba(0,0,0,0)",terminalVelocity:5,random:{number:100,maxMass:2},falling:!0,teleportWalls:!0},solarSystem:{walled:!1,gravity:!0,falling:!1,teleportWalls:!1,backgroundColor:"rgba(0,0,0,1)",terminalVelocity:1e4,particles:[new Particle(1250,700,0,0,1,"#FFFF00",0.25),new Particle(1250,600,0.319,0,0.0553/332946,"#666666",1/332946/10),new Particle(1250,550,0.318,0,0.815/332946,"#FF6666",1/332946),new Particle(1250,500,0.317,0,1/332946,"#00FF00",1/332946),new Particle(1250,425,0.316,0,0.107/332946,"#FF0000",1/332946/5),new Particle(1250,300,0.313,0,317.8/332946,"#997711",200*(1/332946)),new Particle(1250,100,0.3125,0,95.2/332946,"#AA7711",75*(1/332946))]},blackHole:{walled:!1,gravity:!0,falling:!1,teleportWalls:!1,interactive:!0,clickToAdd:!0,backgroundColor:"rgb(0,0,0)",terminalVelocity:1e4,particles:[new Particle(500,0,3,0),new Particle(500,500,0,0,500,"#333",500)]},lattice:{walled:!0,gravity:!1,falling:!1,teleportWalls:!0,interactive:!0,repel:!0,latticeDistance:400,clickToAdd:!1,backgroundColor:"rgba(0,0,0,0)",particleColor:"rgb(255,255,255)",connected:!0,terminalVelocity:0.5,random:{number:75,minMass:0.5,maxMass:0.5,minDx:-0.5,maxDx:0.5,minDy:-0.5,maxDy:0.5}}}}}]),c}();function getMousePos(c,d){var e=c.getBoundingClientRect();return{x:(d.clientX-e.left)*window.devicePixelRatio,y:(d.clientY-e.top)*window.devicePixelRatio}}function distanceBetween(c,d){return Math.sqrt((c.x-d.x)*(c.x-d.x)+(c.y-d.y)*(c.y-d.y))}
